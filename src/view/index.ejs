<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NutriTrack • Overview</title>
  <link rel="stylesheet" href="/output.css" />
  
</head>
<body class="min-h-screen bg-[#F9FAFB] font-poppins text-[#111827]">
  <div class="flex min-h-screen">

    <main class="flex-1">
      <div class="h-14 md:h-16"></div>

      <section class="max-w-5xl mx-auto">
        
        <header class="mb-6">
          <h1 class="text-[28px] leading-8 md:text-[30px] font-semibold">Overview</h1>
        </header>

        <div class="bg-white border border-[#E5E7EB] rounded-xl p-5">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

            <div class="border border-[#E5E7EB] rounded-xl p-4 flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg bg-green-50 text-[#22C55E] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 .06-.312m-2.24 2.39a4.493 4.493 0 0 0-1.757 4.306 4.493 4.493 0 0 0 4.306-1.758M16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
                </svg>
              </div>
              <div>
                <div class="text-[20px] font-semibold leading-none"><%= dailyTotals ? dailyTotals.calories : 0 %></div>
                <div class="text-[12px] text-[#6B7280]">Kcal aujourd'hui</div>
              </div>
            </div>
            <div class="border border-[#E5E7EB] rounded-xl p-4 flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg bg-blue-50 text-[#3B82F6] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 0 0 .75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 0 0-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0 1 12 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 0 1-.673-.38m0 0A2.18 2.18 0 0 1 3 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 0 1 3.413-.387m7.5 0V5.25A2.25 2.25 0 0 0 13.5 3h-3a2.25 2.25 0 0 0-2.25 2.25v.894m7.5 0a48.667 48.667 0 0 0-7.5 0M12 12.75h.008v.008H12v-.008Z" />
                </svg>
              </div>
              <div>
                <div class="text-[20px] font-semibold leading-none"><%= dailyTotals ? Math.round(dailyTotals.carbs) : 0 %>g</div>
                <div class="text-[12px] text-[#6B7280]">Carbs</div>
              </div>
            </div>
            <div class="border border-[#E5E7EB] rounded-xl p-4 flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg bg-blue-50 text-[#3B82F6] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z" />
                </svg>
              </div>
              <div>
                <div class="text-[20px] font-semibold leading-none"><%= dailyTotals ? Math.round(dailyTotals.protein) : 0 %>g</div>
                <div class="text-[12px] text-[#6B7280]">Protein</div>
              </div>
            </div>
            <div class="border border-[#E5E7EB] rounded-xl p-4 flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg bg-red-50 text-[#DC2626] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z" />
                </svg>
              </div>
              <div>
                <div class="text-[20px] font-semibold leading-none"><%= dailyTotals ? Math.round(dailyTotals.fats) : 0 %>g</div>
                <div class="text-[12px] text-[#6B7280]">Fat</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-5 bg-white border border-[#E5E7EB] rounded-xl p-8 text-center">
          <a href="/analyse">
            <div class="mx-auto h-10 w-10 rounded-full bg-green-50 text-[#22C55E] flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M11 5a1 1 0 112 0v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H6a1 1 0 110-2h5V5z"/></svg>
            </div>

          </a>
          <h2 class="mt-3 font-medium">Ajouter un repas</h2>
          <p class="text-[13px] text-[#6B7280] mt-1">Téléchargez une photo de votre repas ou ajoutez manuellement les informations nutritionnelles</p>
          <a href="/analyse">
            <button class="mt-4 inline-flex items-center justify-center px-5 py-2 rounded-md bg-[#22C55E] hover:bg-[#22C55E]Dark text-white text-[14px] font-medium cursor-pointer">Commencer</button>
          </a>
        </div>

        <div class="mt-5 bg-white border border-[#E5E7EB] rounded-xl">
          <div class="p-5 flex justify-between items-center">
            <h3 class="font-medium text-[15px] mb-0">Historique rapide</h3>
            <a href="/historique" class="text-[13px] text-[#22C55E] hover:underline">Voir tout →</a>
          </div>
          <div>
<% if (recentMeals && recentMeals.length > 0) { %>
  <% recentMeals.forEach((meal, index) => { %>
            <div class="px-5 py-3 flex items-center gap-3 <%= index === 0 ? 'border-t' : 'border-t' %> border-[#E5E7EB]">
              <% if (meal.image_base64 && meal.mime_type) { %>
                <img class="h-9 w-9 rounded-md object-cover" src="data:<%= meal.mime_type %>;base64,<%= meal.image_base64 %>" alt="repas"/>
              <% } else { %>
                <div class="h-9 w-9 rounded-md bg-gray-100 flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h4a1 1 0 110 2h-1v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 110-2h4zM6 6v14h12V6H6zm3-2V3h6v1H9z" />
                  </svg>
                </div>
              <% } %>
              <div class="flex-1 min-w-0">
                <div class="text-[14px] leading-tight"><%= meal.name || 'Repas' %></div>
                <div class="text-[12px] text-[#6B7280] leading-tight">
                  <% 
                    const mealDate = new Date(meal.created_at);
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    let dateLabel;
                    if (mealDate.toDateString() === today.toDateString()) {
                      dateLabel = "Aujourd'hui";
                    } else if (mealDate.toDateString() === yesterday.toDateString()) {
                      dateLabel = "Hier";
                    } else {
                      dateLabel = mealDate.toLocaleDateString('fr-FR');
                    }
                    
                    const timeLabel = mealDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                  %>
                  <%= dateLabel %>, <%= timeLabel %>
                </div>
              </div>
              <div class="text-right">
                <div class="text-[13px] font-medium"><%= meal.calories || 0 %> kcal</div>
                <a href="/historique" class="text-[12px] text-[#22C55E]">Voir</a>
              </div>
            </div>
  <% }) %>
<% } else { %>
            <div class="px-5 py-8 text-center border-t border-[#E5E7EB]">
              <div class="text-gray-400 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
              </div>
              <p class="text-[14px] text-[#6B7280] mb-3">Aucun repas analysé pour le moment</p>
              <a href="/analyse" class="inline-flex items-center px-3 py-2 text-sm font-medium text-[#22C55E] bg-green-50 rounded-md hover:bg-green-100 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Analyser votre premier repas
              </a>
            </div>
<% } %>
          </div>
        </div>

      </section>
    </main>
  </div>
</body>
</html>
